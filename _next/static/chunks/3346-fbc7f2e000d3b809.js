"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3346],{41486:function(t,e,i){var n;i.d(e,{D:function(){return n}}),function(t){t.CART="CART",t.CHECKOUT="CHECKOUT",t.PAYMENTS="PAYMENTS",t.ADDRESS="ADDRESS",t.QUESTIONS="QUESTIONS",t.EDIT_ADDRESS="EDIT_ADDRESS"}(n||(n={}))},35965:function(t,e,i){i.d(e,{w:function(){return r},k:function(){return o}});var n=i(67294),a=i(41486);const r=n.createContext({next:async()=>{},currentPage:a.D.CART}),o=()=>(0,n.useContext)(r)},3346:function(t,e,i){i.d(e,{j:function(){return I}});var n=i(67294),a=i(64532),r=i.n(a),o=i(93311);class u{compareOrderItems(t,e){if(t.productId!==e.productId||t.catalogId!==e.catalogId)return!1;if(t.variants){return!Object.keys(t.variants).map((i=>!e.variants[i]||e.variants[i].option.value===t.variants[i].option.value)).includes(!1)}return(!t.typeVariant||!e.typeVariant||t.typeVariant===e.typeVariant)&&(!t.colorVariant||!e.colorVariant||t.colorVariant===e.colorVariant)}}var s=i(27294);class d extends class extends class{getPrice(t,e){var i,n;const a=new u,r=null===(n=null===(i=null===e||void 0===e?void 0:e.updates)||void 0===i?void 0:i.find)||void 0===n?void 0:n.call(i,(e=>a.compareOrderItems(e.item,t)));if(r)return[r.price,r.discountedPrice]}getInventory(t,e){var i;const n=new u,a=null===(i=null===e||void 0===e?void 0:e.updates)||void 0===i?void 0:i.find((e=>n.compareOrderItems(e.item,t)));if(a)return a.inventoryAvailable}filterOutBasedOnZeroItemQuantity(t){return 0!==t.quantity||void 0===t.productId||void 0===t.catalogId}}{async fixWithApiResponse(t,e,i){var n;return{newCartItems:null===(n=[...e.items])||void 0===n?void 0:n.map((e=>{var n;const a=Object.assign({},e),r=this.getPrice(a,i);if("undefined"===typeof r)return a.quantity=0,a;!(null===(n=null===t||void 0===t?void 0:t.meta.extraConfiguration)||void 0===n?void 0:n.showProductPricesInclusiveOfTaxes)&&r&&a.price!==r[1]&&(a.price=r[1]);const o=Number(this.getInventory(a,i));return"undefined"===typeof o?(a.quantity=0,a):(o<=0&&(a.quantity>a.maximumOrderQuantity&&-1!==o?a.quantity=a.maximumOrderQuantity:0===o&&(a.quantity=0)),o>0&&o<a.quantity&&(a.quantity=o),o>0&&(a.maximumOrderQuantity=Math.min(a.maximumOrderQuantity||500,o)),a.quantity<a.minimumOrderQuantity&&a.quantity>0?a.quantity=a.minimumOrderQuantity:a.quantity>a.maximumOrderQuantity&&(a.quantity=a.maximumOrderQuantity),a)})).filter(this.filterOutBasedOnZeroItemQuantity),validationState:s.s4.validationState,modalState:s.Us.NO_MODAL}}async fixPriceWithApiResponse(t,e,i){var n;return{newCartItems:null===(n=[...e.items])||void 0===n?void 0:n.map((e=>{var n;const a=Object.assign({},e),r=this.getPrice(a,i);"undefined"===typeof r&&(a.quantity=0);return!(null===(n=null===t||void 0===t?void 0:t.meta.extraConfiguration)||void 0===n?void 0:n.showProductPricesInclusiveOfTaxes)&&r&&a.price!==r[1]&&(a.price=r[1]),a})).filter(this.filterOutBasedOnZeroItemQuantity)}}}{async validateAndfixOutOfStockCartItem(t,e,i,n){const a=null!==n&&void 0!==n?n:await this.fetchLatestData(t.meta.id,e.items,!!i);if(a){return await this.fixWithApiResponse(t,e,a)}return null}async checkFooterMessage(t,e,i,n,a,r=!0){let o=r;const u=null===t||void 0===t?void 0:t.meta,s={bigErrorMessage:"",errorMessage:"",infoMessage:""},d=null!==a&&void 0!==a?a:"infoMessage",c=u.minimumCheckoutValue||null,l=u.maximumCheckoutValue||null;if(c&&e.subTotal<c){const t=n(c);s[d]=`Minimum purchase of ${t} is required`,o=!1}if(l&&e.subTotal>l){const t=n(l);s[d]=`Maximum purchase of ${t} is allowed`,o=!1}return{isValid:o,footerState:s}}async fetchLatestData(t,e,i){const n=o.q.functions.FASITY_FUNCTION+"/ordersApiFunctions-verifyCart",a={storeId:t,items:e,isB2bEnabled:i};try{const t=await r().post(n,a,{headers:{"content-type":"application/json"},responseType:"text"});return t.data}catch(u){return null}}async getValidationStateOnApiResponse(t,e,i){var n,a,r,o;const u=t.items,s=Object.assign({},e),d=Object.assign({},s.errors),c=[...null!==(n=s.outOfStockItems)&&void 0!==n?n:[]],l=[...null!==(a=s.outOfStockItemInventory)&&void 0!==a?a:[]],m=[...null!==(r=s.itemsToChange)&&void 0!==r?r:[]],v=[...null!==(o=s.itemsToChangeInventory)&&void 0!==o?o:[]],p=Object.keys(d);return null===u||void 0===u||u.forEach(((t,e)=>{const n=Number(this.getInventory(t,i)),a=t.quantity,r=t.maximumOrderQuantity||500,o=t.minimumOrderQuantity||0;p.includes(e.toString())||(0===n&&(d[e]="Out of Stock",c.push(t),l.push(a)),-2===n?(d[e]="Out of Stock",c.push(t),l.push(a)):n&&-1!==n&&a>n?(d[e]=`Only ${n} in stock`,c.push(t),l.push(a)):a>r&&-1!==n?(d[e]=`Maximum ${r} allowed`,c.push(t),l.push(a)):a<o?(d[e]=`Minimum ${o} required`,m.push(t),v.push(a)):a||(d[e]="Minimum 1 required",m.push(t)))})),{errors:d,outOfStockItems:c,outOfStockItemInventory:l,itemsToChange:m,itemsToChangeInventory:v,headerMessage:(null===c||void 0===c?void 0:c.length)?c.length>1?`${c.length} items are out of stock`:`${c.length} item is out of stock`:"Invalid Cart"}}}var c=i(92293),l=i(43324),m=i(7034),v=i(29782),p=i(35965),f=i(79389),g=i(5540),y=i(96284);function I(){const t=(0,l.CG)((t=>t.cartState)),e=(0,l.TL)(),{next:i,currentPage:a}=(0,p.k)(),r=(0,l.CG)((t=>t.customerState)),o=(0,l.CG)((t=>t.storeState.store.meta)),[u,I]=(0,n.useState)(!1),{formatCurrency:C}=(0,m.U)(),S=new d,h=(0,l.CG)((t=>t.cartState.uiCart)),O=(0,l.CG)((t=>t.storeState.store)),b=new f.m,M=new v.i(Object.assign({},t.uiCart),e);async function k(t){(null===o||void 0===o?void 0:o.loginCompulsory)&&!r.isLoggedIn?c.u.login({}).subscribe((async n=>{n&&t&&await i(),e(s.W2.setCartLoading(!1))})):(t&&await i(),e(s.W2.setCartLoading(!1)))}async function w(i,n,a=!0){var r;e(s.W2.setCartValidationFlag(!0)),e(s.W2.setCartLoading(!0)),e(s.W2.updateFooterState({errorMessage:"",bigErrorMessage:""}));let o=a;const u=await S.checkFooterMessage(O,h,t.footerState,i,null!==n&&void 0!==n?n:"errorMessage");if(o=u.isValid,e(s.W2.updateFooterState(u.footerState)),!o)return e(s.W2.setCartLoading(!1)),!1;if(null===(r=null===O||void 0===O?void 0:O.meta)||void 0===r?void 0:r.id){const i=await Promise.race([S.fetchLatestData(O.meta.id,h.items,!!(null===O||void 0===O?void 0:O.isb2bEnabled)),new Promise((t=>{setTimeout((()=>t(null)),2e3)}))]);if(console.log({verifyCartResponse:i}),null===i)return!0;if(i){t.savedValidationApiResponse||e(s.W2.setSavedValidationApiResponse(i));const{newCartItems:n}=await S.fixPriceWithApiResponse(O,h,i);e(s.W2.setValidatedCartItem({items:n}));const{errors:a,outOfStockItems:r,outOfStockItemInventory:u,itemsToChange:d,itemsToChangeInventory:c,headerMessage:l}=await S.getValidationStateOnApiResponse(h,t.validationState,i);e(s.W2.updateValidationState({errors:a,outOfStockItems:r,outOfStockItemInventory:u,itemsToChange:d,itemsToChangeInventory:c,headerMessage:l})),a&&Object.keys(a).length&&(o=!1)}}return o||(e(s.W2.setCartLoading(!1)),!1)}function T(){e(s.W2.loadFromCache(O))}return(0,n.useEffect)((()=>{u&&o&&o.id&&w(C,"infoMessage").then((()=>{e(s.W2.setCartLoading(!1)),t.uiCart.promo&&t.uiCart&&(e(g.OQ.setPromoCode(t.uiCart.promoData.promo.code)),b.applyPromo(t.uiCart))}))}),[u]),(0,n.useEffect)((()=>{o&&o.id&&S.checkFooterMessage(O,h,t.footerState,C,"infoMessage").then((t=>{e(s.W2.updateFooterState(t.footerState))}))}),[t.uiCart,null===o||void 0===o?void 0:o.id]),{init:async function(){e(s.W2.setCartLoading(!0)),T(),I(!0),e(s.W2.setCartLoading(!1))},cartState:t,loadFromCache:T,addItem:M.addItem.bind(M),findItem:M.incrementQuantity.bind(M),incrementQuantity:M.incrementQuantity.bind(M),getVariantsOfItem:function(e,i){return t.uiCart.items.filter((t=>t.catalogId.toString()===e.toString()&&t.productId.toString()===i.toString()))},setItemQuantity:M.setItemQuantity.bind(M),setItemMargin:M.setItemMargin.bind(M),decrementQuantity:M.decrementQuantity.bind(M),removeItem:M.removeItem.bind(M),next:async function(){"undefined"!==typeof o.isStoreOpen&&o.isStoreOpen?(e(s.W2.updateFooterState({errorMessage:"",bigErrorMessage:""})),"PAYMENTS"===a||"CHECKOUT"===a?await k(!0):w(C,"errorMessage",!0).then((async t=>{await k(t)}))):e(s.W2.setCartLoading(!1))},validateCart:w,validateAndfixOutOfStockCartItem:()=>{return t=async()=>S.validateAndfixOutOfStockCartItem(O,h,O.isb2bEnabled),e(s.W2.setCartLoading(!0)),t().then((t=>(e(s.W2.setCartLoading(!1)),t)));var t},addItemInCartForMultipleVarint:function(t,e,i,n={}){const{product:a,catalogId:r}=t,{image:o,skuId:u,itemPrice:s}=(new y.y).prepareOrderItem(t,n);return M.addItemMultiVarinats(parseInt(r),parseInt(a.id),s,null===a||void 0===a?void 0:a.name,i,o,null===a||void 0===a?void 0:a.price,u,null===e||void 0===e?void 0:e.maximumOrderQuantity,null===e||void 0===e?void 0:e.minimumOrderQuantity,n)},getTotalQuantityForMultiplVariants:function(t,e){let i=0;return l.ZP.getState().cartState.uiCart.items.forEach((n=>{n.catalogId.toString()===t.toString()&&n.productId.toString()===e.toString()&&(i+=n.quantity)})),i},decrementQuantityMultipleVariants:M.decrementQuantityMultipleVariants.bind(M),empty:function(){e(s.W2.emptyCart({store:O}))}}}},7034:function(t,e,i){i.d(e,{U:function(){return a}});var n=i(43324);function a(){const t=(0,n.CG)((t=>{var e;return null===(e=t.storeState.snapshotStore)||void 0===e?void 0:e.meta}));return{formatCurrency:function(e,i=!1){var n;try{const a=new Intl.NumberFormat("en-IN",{style:"currency",currency:null!==(n=null===t||void 0===t?void 0:t.currency)&&void 0!==n?n:"INR"}).format;if(i){return a(e).split(".")[0]}return a(e)}catch(a){return`\u20b9${e}`}}}}},96284:function(t,e,i){i.d(e,{y:function(){return a}});var n=i(77646);class a{prepareOrderItem(t,e={}){var i;const{product:n}=t;let a,r=null===n||void 0===n?void 0:n.image,o=null===n||void 0===n?void 0:n.skuId;(null===n||void 0===n?void 0:n.combinations.length)&&(a=null===n||void 0===n?void 0:n.getCombinationForMultipleVariants(e)[0],(null===(i=null===a||void 0===a?void 0:a.variantImages)||void 0===i?void 0:i.length)&&(r=a.variantImages[0].photoUrl),a&&a.skuId&&(o=a.skuId));return{image:r,skuId:o,itemPrice:(null===n||void 0===n?void 0:n.discountedPrice)&&(null===n||void 0===n?void 0:n.discountedPrice)<(null===n||void 0===n?void 0:n.price)?null===n||void 0===n?void 0:n.discountedPrice:null===n||void 0===n?void 0:n.price}}getColorAndCustomFromMUltipleVariant(t,e){let i,n;return Object.keys(t).map((a=>{"color"===a.toLowerCase()&&(i=t[a].option.value),a.toLowerCase()===e.customVariantName.toLowerCase()&&(n=t[a].option.value)})),{color:i,custom:n}}}a.getProductKey=t=>t.catalogId.toString()+"-"+t.productId.toString(),a.convertItemToOrderItem=(t,e)=>{const i=new n.OrderItem;return i.catalogId=parseInt(e,0),i.productId=parseInt(t.id,0),i.price=t.discountedPrice,i.mrp=t.price,i.image=t.image,i.name=t.name||"",i.name&&(i.name=i.name[0].toUpperCase()+i.name.substring(1).toLowerCase()),i},a.convertOrderItemToPartialItem=t=>{var e;const i=new n.Item;return i.id=t.productId.toString(),i.name=t.name,i.discountedPrice=t.price,i.price=null!==(e=t.mrp)&&void 0!==e?e:t.price,i.image=t.image,i}}}]);