"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7541],{49150:function(t,e,n){n.d(e,{y:function(){return y}});var a=n(25480),i=n(14527),r=n(3181),s=n(59608),o=n(54493);class c{static nativeWindow(){return window}}const d={[a.b.PERSONAL_PAYTM]:async()=>new i.w,[a.b.DEFAULT_RAZORPAY]:async()=>new r.t(c.nativeWindow()),[a.b.PERSONAL_RAZORPAY]:async()=>new r.t(c.nativeWindow()),[a.b.STRIPE]:async()=>new o.t,[a.b.PAYPAL]:async()=>new s.j(c.nativeWindow())};class y{constructor(t){this.storeMeta=t}fetchPaymentGateway(){var t;const e=null===(t=this.storeMeta.extraConfiguration)||void 0===t?void 0:t.paymentGatewayType;return e===a.b.PERSONAL_PAYTM||"PERSONAL_PAYTM"===e?(this.storeMeta.extraConfiguration.paymentGatewayType="PAYTM",a.b.PERSONAL_PAYTM):e===a.b.PERSONAL_RAZORPAY?a.b.PERSONAL_RAZORPAY:e===a.b.PAYPAL?a.b.PAYPAL:e===a.b.STRIPE?a.b.STRIPE:void 0}async setUp(){var t,e,n;const i=("ultimate"===(null===(t=this.storeMeta)||void 0===t?void 0:t.packageType)||"vip"===(null===(e=this.storeMeta)||void 0===e?void 0:e.packageType))&&!!(null===(n=this.storeMeta.extraConfiguration)||void 0===n?void 0:n.paymentGatewayType);console.log("inside fetching .. ",i),this.paymentGateway=i?this.fetchPaymentGateway():a.b.DEFAULT_RAZORPAY,await this.loadPaymentService()}async loadPaymentService(){d[this.paymentGateway]?this.paymentProcessor=await d[this.paymentGateway]():this.storeMeta.paymentInformation.onlineEnabled=!1}async getPaymentGateway(){return this.paymentProcessor||await this.setUp(),this.paymentGateway}}},25480:function(t,e,n){var a,i;n.d(e,{G:function(){return a},b:function(){return i}}),function(t){t.ORDER="ORDER",t.WALLET_RECHARGE="CREDIT_WALLET_CUSTOMER"}(a||(a={})),function(t){t.PERSONAL_PAYTM="PAYTM",t.DEFAULT_RAZORPAY="rzp",t.PERSONAL_RAZORPAY="PERSONAL_RAZORPAY",t.PAYPAL="PAYPAL",t.STRIPE="STRIPE"}(i||(i={}))},96520:function(t,e,n){n.d(e,{c:function(){return i},B:function(){return r}});var a=n(25480);class i{constructor(t,e,n,a,i){this.success=t,this.errorMessage=e,this.paymentId=n,this.extraPayload=a,this.sessionId=i}}class r{setPayLoadForRequest(t,e,n,i,r="rzp",s="INR"){const o={storeId:t,pgData:{},payload:{},paymentProcessor:r,amount:e,type:n,currency:s};switch(n){case a.G.ORDER:o.payload={order:i};break;case a.G.WALLET_RECHARGE:}return o}}},59608:function(t,e,n){n.d(e,{j:function(){return d}});var a=n(96520),i=n(8195),r=n(58239),s=n(47984),o=n(43324),c=n(93311);class d extends a.B{constructor(t){super(),this.nativeWindow=t,this.storeHelper=i.N.getInstance(),this.scriptLoaderService=r.$.getInstance(),this.headers={"Content-Type":"application/json"}}init(){this.loadPaypalScript().then().catch()}async initiatePayment(t){const e=`${c.q.functions.CLOUD_FUNCTION_URL_INDIA}/paymentsApiFunctions-initiatePayment`;try{return(await s.sM.sendData({apiPath:e,requestHeader:this.headers,apiMethod:s.s1.POST,requestBody:t})).data}catch(n){return console.error(n),{}}}async makePayment(t){if(t.amount<500)return new a.c(!1,"Minimum amount of $5 is required to pay online.");await this.loadPaypalScript();const e=Object.assign({},t);e.amount=t.amount/100,e.currency="USD";const n=e.payload.order.customerName.substring(0,e.payload.order.customerName.indexOf("Address"));e.payload.order.customerFirstName=n.split(" ")[0],e.payload.order.customerLastName=n.split(" ")[1]?n.split(" ")[1]:"","Not Specified"===e.payload.order.customerEmail&&delete e.payload.order.customerEmail;const i=await this.initiatePayment(e);if(200!==i.status)return new a.c(!1,"Payment Failed. Please try again");const r=i.gatewayResponse.paymentId;return new Promise(((t,e)=>{window.paypal.Buttons({createOrder:async function(){return i.gatewayResponse.orderId},onApprove:(e,n)=>{n.order.capture().then((e=>{t(new a.c(!0,"",r,e))}))},onError:function(){e(new a.c(!1,"Payment Failed. Please try again"))},onCancel:function(){e(new a.c(!1,"Payment Cancelled"))}}).render("#paypalModal")}))}async loadPaypalScript(){await this.loadMID(),await this.scriptLoaderService.load({name:"Paypal",src:`https://www.paypal.com/sdk/js?client-id=${this.mid}`,loaded:!1,existing:!1})}async loadMID(){const t=o.ZP.getState().storeState.store;if(!t)return;const e=t.meta.paymentInformation.enableStagingPayments;this.mid=e?"AeZRW7sQz40Gk5vgmTW9Yv1qN_YYlXjD7JG8x2-GhyVI_xzHOVw1Wd2oU4qogmOVvncmYeuVQ65GTjOD":t.meta.extraConfiguration.paymentGatewayKey}}},14527:function(t,e,n){n.d(e,{w:function(){return y}});var a=n(52923),i=n(58239),r=n(64532),s=n.n(r),o=n(96520),c=n(43324),d=n(93311);class y extends o.B{constructor(){super(),this.processingExternalPayment=!1,this.scriptLoaderService=i.$.getInstance(),this.isPaymentLink=!1,this.nativeWindow=window,this.paytmScriptDomain="https://securegw.paytm.in"}async initiatePaytmTransaction(t){const e=`${d.q.functions.FASITY_FUNCTION}/paymentsApiFunctions-initiatePayment`,n=a.j.encrypt(JSON.stringify(t)),i=await s().post(e,n,{headers:{"content-type":"text/plain"},responseType:"text"});if(!i.data)return;const r=a.j.decrypt(i.data);return JSON.parse(r)}async loadPaytmScript(){return await this.loadMID(),await this.scriptLoaderService.load({name:"Paytm",src:`${this.paytmScriptDomain}/merchantpgpui/checkoutjs/merchants/${this.mid}.js`,loaded:!1,existing:!1})}init(){this.loadPaytmScript().then().catch()}async makePayment(t){this.processingExternalPayment=!0;const e=this,n=await this.loadPaytmScript(),a=this.nativeWindow;return a.Paytm&&a.Paytm.CheckoutJS?n.existing?await this.processPaytmPayment(t):new Promise((async n=>{a.Paytm.CheckoutJS.onLoad((function(){e.processPaytmPayment(t).then((t=>{n(t)}))}))})):new o.c(!1,void 0)}async processPaytmPayment(t){const e=c.ZP.getState().storeState.store.meta.paymentInformation.enableStagingPayments,n=t.amount;if(e&&(t.isStaging=!0),n<500&&!e)return new o.c(!1,"Minimum amount of Rs 5 is required to pay online.");const a=await this.initiatePaytmTransaction(t),i=this,r=a.gatewayResponse;if(a&&200===a.status){const t=r.paytm,e=r.paymentId;return new Promise((a=>{const s={root:"",flow:"DEFAULT",data:{orderId:e,token:t,tokenType:"TXN_TOKEN",amount:n/100},merchant:{redirect:!0},handler:{notifyMerchant:function(t){"APP_CLOSED"===t&&(i.processingExternalPayment=!1,a(new o.c(!1,void 0)))},transactionStatus:function(t){i.nativeWindow.Paytm.CheckoutJS.close(),i.processingExternalPayment=!1;const e="TXN_SUCCESS"===t.STATUS;a(new o.c(e,e?void 0:"Transaction Failed. Please try again or contact support",r.paymentId))}}};this.nativeWindow.Paytm.CheckoutJS.init(s).then((function(){i.nativeWindow.Paytm.CheckoutJS.invoke()})).catch((function(){i.processingExternalPayment=!1,a(new o.c(!1,void 0))}))}))}return new o.c(!1,"Transaction Failed. Please contact support")}async loadMID(){const t=c.ZP.getState().storeState.store;if(!t)return;const e=t.meta.paymentInformation.enableStagingPayments;this.mid=e?"SAqaBt37249648883222":t.meta.extraConfiguration.paymentGatewayKey}}},3181:function(t,e,n){n.d(e,{t:function(){return l}});var a=n(96520),i=n(52923),r=n(58239),s=n(43324),o=n(25480),c=n(64532),d=n.n(c),y=n(8195),m=n(93311),p=n(86862);class l extends a.B{constructor(t){super(),this.nativeWindow=t,this.storeHelper=y.N.getInstance(),this.scriptLoaderService=r.$.getInstance(),this.isPersonalGatewayEnabled=!1,this.options={key:"rzp_live_Ak6Ir9VF7KoNb5",name:"Bikayi",image:"./../../../assets/bikayilogo.png",order_id:"",redirect:!1,theme:{color:"#A38DFA"},prefill:{},modal:{}},this.isPaymentLink=!1,this.processingExternalPayment=!1}checkoutToBikayiSecure(t,e,n,a){let i=s.ZP.getState().storeState.store.meta.logoUrl;i=i?i.split("=").slice(-1)[0]:"none",a=a.replace(/,/g,".");const r=`https://secure.bikayi.com/${t}/${e}/${function(t){let e="";const n=["(",")","-"];for(let a=0,i=(t=encodeURI(t)).length;a<i;a++)n.indexOf(t[a])>=0?e+="%"+parseInt(t.charCodeAt(a).toString()).toString(16):e+=t[a];return e}(n)}/${encodeURI(a)}/${i}`;window.location.replace(r)}async fetchOrCreateRazorPayOrderForExternalPayment(t){const e=s.ZP.getState().storeState.store;if(this.orderOrNewPaymentId)return!0;t.type,o.G.ORDER,this.orderOrNewPaymentId=await this.initiateOrderForExternalPayment(t);if(navigator.userAgent.includes("wv")){this.options.redirect=!0;const t=`${m.q.functions.FASITY_FUNCTION}/paymentsApiFunctions-redirectToPaymentConfirmationPage?storeId=${null===e||void 0===e?void 0:e.meta.id}&uid=${this.orderOrNewPaymentId}`;this.options.callback_url=t}return!(!this.orderOrNewPaymentId||"restricted"===this.orderOrNewPaymentId)&&(!this.isPaymentLink&&(t.type,o.G.ORDER),!!this.orderOrNewPaymentId)}async initiateOrderForExternalPayment(t){const e=s.ZP.getState().storeState.store;if(t.type!==o.G.ORDER||this.isPersonalGatewayEnabled){const e=await this.initiateTransactionV2(t);if(!e||200!==e.status)return;return this.orderOrNewPaymentId=e.gatewayResponse.paymentId,e.gatewayResponse.orderId}{const n=m.q.functions.FASITY_FUNCTION+"/initiateOrderForExternalPayment",a={amount:parseInt(t.amount.toString(),10),currency:t.currency?t.currency:"INR",storeId:e.meta.id,order:t.payload.order,processor:"rzp"},r=i.j.encrypt(JSON.stringify(a)),s=await d().post(n,r,{headers:{"content-type":"text/plain"},responseType:"text"});return i.j.decrypt(s.data)}}async initiateTransactionV2(t){const e=`${m.q.functions.FASITY_FUNCTION}/paymentsApiFunctions-initiatePayment`,n=i.j.encrypt(JSON.stringify(t)),a=await d().post(e,n,{headers:{"content-type":"text/plain"},responseType:"text"});if(!a.data)return;const r=i.j.decrypt(a.data);return JSON.parse(r)}async loadRZPScript(){await this.scriptLoaderService.load({name:"RZP",src:"https://checkout.razorpay.com/v1/checkout.js",loaded:!1,existing:!1})}init(){this.loadRZPScript().then().catch()}resetPayment(){this.orderOrNewPaymentId=void 0}async makePayment(t){var e,n;const i=s.ZP.getState().storeState.store,r=i.meta.id,o=i.meta.paymentInformation.enableStagingPayments||!1;await this.loadRZPScript(),this.processingExternalPayment=!0,this.isPersonalGatewayEnabled="PERSONAL_RAZORPAY"===(null===(e=i.meta.extraConfiguration)||void 0===e?void 0:e.paymentGatewayType),this.options.key=this.isPersonalGatewayEnabled?i.meta.extraConfiguration.paymentGatewayKey:this.options.key,o&&(t.isStaging=!0,this.options.key="rzp_test_bIRJZBMOGbK8TT");const c=!!s.ZP.getState().cartState.uiCart.paymentBreakdown.walletCredits;if(t.amount<500&&!o&&!c)return new a.c(!1,"Minimum amount of Rs 5 is required to pay online.");this.options.amount=t.amount.toString(),this.options.name=i.meta.name,this.options.description=`Payment for ${i.meta.name}`,this.options.notes={paymentType:"external",storeId:null===i||void 0===i?void 0:i.meta.id},i.meta.logoUrl&&(this.options.image=i.meta.logoUrl);if(await this.fetchOrCreateRazorPayOrderForExternalPayment(t)){const t=this;this.options.order_id=this.orderOrNewPaymentId;if(s.ZP.getState().configurationState.isCustomDomain&&!this.isPersonalGatewayEnabled&&this.orderOrNewPaymentId)return this.checkoutToBikayiSecure(r,this.orderOrNewPaymentId,i.meta.name,i.meta.username),new a.c(!1,"Custom domain and no personal gateway");const e=s.ZP.getState().customerState;return this.isPersonalGatewayEnabled&&e.isLoggedIn?this.options.prefill.contact=`+91-${null===(n=e.customer)||void 0===n?void 0:n.phone}`:this.isPersonalGatewayEnabled&&!e.isLoggedIn&&(this.options.prefill.contact=`+91-${e.userInfo.phoneNumber}`),await new Promise((e=>{this.options.handler=t=>{const n=t.razorpay_order_id,i=t.razorpay_payment_id,r=t.razorpay_signature;s.ZP.dispatch(p.u.updateContextState({razorPayContext:{signature:r,orderId:n,paymentId:i}})),e(new a.c(!0,"",i,t)),this.processingExternalPayment=!1},this.options.modal.ondismiss=function(){delete t.orderOrNewPaymentId,t.processingExternalPayment=!1,e(new a.c(!1))},this.rzp1=new window.Razorpay(this.options),this.rzp1.open()}))}return this.processingExternalPayment=!1,new a.c(!1,"Payment limit restricted, Contact support")}}},54493:function(t,e,n){n.d(e,{t:function(){return y}});var a=n(96520),i=n(58239),r=n(43324),s=n(52923),o=n(64532),c=n.n(o),d=n(93311);class y extends a.B{constructor(){super(),this.scriptLoaderService=i.$.getInstance()}async loadStripeScript(){await this.scriptLoaderService.load({name:"Stripe",src:"https://js.stripe.com/v3/",loaded:!1,existing:!1})}init(){this.loadStripeScript().then().catch()}async makePayment(t){try{return await this.loadStripeScript(),await this.processStripePayment(t)}catch(e){return new a.c(!1,null===e||void 0===e?void 0:e.message)}}async processStripePayment(t){const e=r.ZP.getState().storeState.store.meta.paymentInformation.enableStagingPayments;if(e&&(t.isStaging=!0),t.amount<500&&!e)return new a.c(!1,"Minimum amount of Rs 5 is required to pay online.");t.amount/=100;const n=await this.initiateStripePayment(t);if(Object.keys(n).length>0&&n.gatewayResponse){const t=n.gatewayResponse;if(t.redirectUrl&&t.paymentId&&t.sessionId){const{redirectUrl:e}=t;return void window.location.replace(e)}}return new a.c(!1,void 0)}async initiateStripePayment(t){try{const e=`${d.q.functions.CLOUD_FUNCTION_URL_INDIA}/paymentsApiFunctions-initiatePayment`,n=s.j.encrypt(JSON.stringify(t)),a=await c().post(e,n,{headers:{"content-type":"text/plain"},responseType:"text"});if(!a.data)return;return JSON.parse(s.j.decrypt(a.data))}catch(e){return}}}},37541:function(t,e,n){n.d(e,{G4:function(){return a.G},bI:function(){return a.b},yS:function(){return i.y}});n(96520);var a=n(25480),i=(n(14527),n(3181),n(97839),n(49150));n(54493),n(59608)},97839:function(t,e,n){var a=n(67294),i=n(64532),r=n.n(i),s=n(23218),o=n(8195),c=n(25617),d=n(93311);e.Z=t=>{var e,n;const i=[0,3e3,5e3,1e4,15e3],[y,m]=(0,a.useState)(!0),[p,l]=(0,a.useState)(!1),u=(null===(e=t.routeParams)||void 0===e?void 0:e.paymentId)||t.paymentId,h=(null===(n=t.routeParams)||void 0===n?void 0:n.sessionId)||(null===t||void 0===t?void 0:t.sessionId)||void 0,P=(0,c.v9)((t=>t.storeState.store)),w=e=>{e<i.length?setTimeout((()=>{(async(t,e)=>{try{const n={uid:t};e&&(n.sessionId=e);const a=`${d.q.functions.FASITY_FUNCTION}/paymentsApiFunctions-checkPaymentStatusAndTakeAction`;return(await r().post(a,n,{responseType:"text"})).data.response}catch(n){return void m(!1)}})(u,h).then((n=>{"200"===(null===n||void 0===n?void 0:n.status)?(m(!1),t.cartService.loadFromCache(),t.cartService.empty(),t.actionService.redirectToOrderPlacedPage(n.data.orderId,!0)):(l(!0),w(e+1))}),(()=>{w(e+1)}))}),i[e]):m(!1)};(0,a.useEffect)((()=>{S().then((()=>{}))}),[]),(0,a.useEffect)((()=>{P.meta&&w(0)}),[P.meta]);const S=async()=>{const e={paymentId:u,sessionId:h};if((new s.s).setUp(e),!P.meta){const e=new o.N;await e.loadRoute(t.routeParams)}};if(!P.meta)return a.createElement(a.Fragment,null);return a.createElement("div",null,a.createElement("div",{className:"loading__container loading"},y&&a.createElement("div",{className:"center-contents-vertical"},a.createElement("div",{className:"lds-ring"},a.createElement("div",null),a.createElement("div",null),a.createElement("div",null),a.createElement("div",null)),a.createElement("div",{className:"loading-label"},"Loading payment status")),!y&&p&&a.createElement("div",{className:"center-contents-vertical"},a.createElement("div",{className:"loading-label"},"Payment failed"),a.createElement("button",{className:"btn btn-primary",onClick:function(){t.actionService.redirectToCart()}},"Continue Shopping"))))}}}]);